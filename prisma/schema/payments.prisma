model Payment {
  id              Int           @id @default(autoincrement())
  order_id        Int
  amount_in_cents Int           @default(0)
  charge_in_cents Int           @default(0)
  method          PaymentMethod
  reference       String?
  date            DateTime @db.Timestamptz(3)      @default(now())
  notes           String?
  created_at      DateTime @db.Timestamptz(3)      @default(now())
  updated_at      DateTime @db.Timestamptz(3)      @updatedAt
  user_id         String
  order           Order         @relation(fields: [order_id], references: [id], onDelete: Cascade)
  user            User          @relation(fields: [user_id], references: [id])
}

model Discount {
  id                Int          @id @default(autoincrement())
  order_id          Int
  user_id           String
  type              DiscountType
  description       String?
  rate              Int?         @default(0)
  discount_in_cents Int          @default(0)
  created_at        DateTime @db.Timestamptz(3)     @default(now())
  order             Order        @relation(fields: [order_id], references: [id], onDelete: Cascade)
  user              User         @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model InterAgencyDebt {
  id                        Int        @id @default(autoincrement())
  debtor_agency_id          Int
  creditor_agency_id        Int
  dispatch_id               Int
  amount_in_cents           Int        @default(0)
  original_sender_agency_id Int
  relationship              String
  status                    DebtStatus @default(PENDING)
  created_at                DateTime @db.Timestamptz(3)   @default(now())
  updated_at                DateTime @db.Timestamptz(3)   @updatedAt
  paid_at                   DateTime? @db.Timestamptz(3)
  paid_by_id                String?
  notes                     String?
  creditor_agency           Agency     @relation("CreditorAgency", fields: [creditor_agency_id], references: [id])
  debtor_agency             Agency     @relation("DebtorAgency", fields: [debtor_agency_id], references: [id])
  dispatch                  Dispatch   @relation(fields: [dispatch_id], references: [id], onDelete: Cascade)
  original_sender_agency    Agency     @relation("OriginalSenderAgency", fields: [original_sender_agency_id], references: [id])
  paid_by                   User?      @relation("DebtPaidBy", fields: [paid_by_id], references: [id])

  @@index([debtor_agency_id, creditor_agency_id])
  @@index([dispatch_id])
  @@index([status])
  @@index([original_sender_agency_id])
  @@index([creditor_agency_id, status])
  @@index([debtor_agency_id, status])
}

model Counter {
  id         Int      @id @default(autoincrement())
  date       String
  agency_id  Int
  counter    Int
  created_at DateTime @db.Timestamptz(3) @default(now())
  updated_at DateTime @db.Timestamptz(3) @updatedAt
  agency     Agency   @relation(fields: [agency_id], references: [id], onDelete: Cascade)

  @@unique([date, agency_id])
}
