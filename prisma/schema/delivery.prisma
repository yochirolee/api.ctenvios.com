model DeliveryRoute {
  id             Int                  @id @default(autoincrement())
  route_number   String               @unique
  carrier_id     Int
  warehouse_id   Int
  messenger_id   String
  province_id    Int
  status         RouteStatus          @default(PLANNING)
  scheduled_date DateTime @db.Timestamptz(3)
  started_at     DateTime? @db.Timestamptz(3)
  completed_at   DateTime? @db.Timestamptz(3)
  notes          String?
  created_at     DateTime @db.Timestamptz(3)             @default(now())
  updated_at     DateTime @db.Timestamptz(3)             @updatedAt
  created_by_id  String
  assignments    DeliveryAssignment[]
  carrier        Carrier              @relation(fields: [carrier_id], references: [id])
  created_by     User                 @relation("route_created_by", fields: [created_by_id], references: [id])
  messenger      User                 @relation("route_messenger", fields: [messenger_id], references: [id])
  province       Province             @relation(fields: [province_id], references: [id])
  warehouse      Warehouse            @relation(fields: [warehouse_id], references: [id])

  @@index([carrier_id, status])
  @@index([messenger_id, scheduled_date])
  @@index([warehouse_id])
  @@index([province_id])
  @@index([scheduled_date])
}

model DeliveryAssignment {
  id              Int            @id @default(autoincrement())
  parcel_id       Int            @unique
  route_id        Int?
  messenger_id    String?
  status          DeliveryStatus @default(PENDING)
  attempts        Int            @default(0)
  last_attempt_at DateTime? @db.Timestamptz(3)
  delivered_at    DateTime? @db.Timestamptz(3)
  recipient_name  String?
  recipient_ci    String?
  signature       String?
  photo_proof     String?
  notes           String?
  created_at      DateTime @db.Timestamptz(3)       @default(now())
  updated_at      DateTime @db.Timestamptz(3)       @updatedAt
  messenger       User?          @relation("assignment_messenger", fields: [messenger_id], references: [id])
  parcel          Parcel         @relation(fields: [parcel_id], references: [id])
  route           DeliveryRoute? @relation(fields: [route_id], references: [id])

  @@index([route_id, status])
  @@index([messenger_id, status])
  @@index([status])
}
