model ManifestVerification {
  id             Int                   @id @default(autoincrement())
  container_id   Int?
  flight_id      Int?
  status         VerificationStatus    @default(IN_PROGRESS)
  expected_count Int
  received_count Int                   @default(0)
  missing_count  Int                   @default(0)
  extra_count    Int                   @default(0)
  verified_by_id String
  started_at     DateTime @db.Timestamptz(3)              @default(now())
  completed_at   DateTime? @db.Timestamptz(3)
  notes          String?
  created_at     DateTime @db.Timestamptz(3)              @default(now())
  updated_at     DateTime @db.Timestamptz(3)              @updatedAt
  discrepancies  ManifestDiscrepancy[]
  container      Container?            @relation(fields: [container_id], references: [id])
  flight         Flight?               @relation(fields: [flight_id], references: [id])
  verified_by    User                  @relation("manifest_verifications", fields: [verified_by_id], references: [id])

  @@index([container_id])
  @@index([flight_id])
  @@index([status])
}

model ManifestDiscrepancy {
  id               Int                  @id @default(autoincrement())
  verification_id  Int
  parcel_id        Int?
  tracking_number  String
  discrepancy_type DiscrepancyType
  resolution       String?
  resolved_at      DateTime? @db.Timestamptz(3)
  resolved_by_id   String?
  created_at       DateTime @db.Timestamptz(3)             @default(now())
  updated_at       DateTime @db.Timestamptz(3)             @updatedAt
  parcel           Parcel?              @relation(fields: [parcel_id], references: [id])
  resolved_by      User?                @relation("discrepancy_resolutions", fields: [resolved_by_id], references: [id])
  verification     ManifestVerification @relation(fields: [verification_id], references: [id], onDelete: Cascade)

  @@index([verification_id])
  @@index([parcel_id])
  @@index([discrepancy_type])
}
